{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\momod\\\\T-JSF-600-PAR_2\\\\irc-client\\\\src\\\\Hometalk.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport './Hometalk.css';\nimport ChatComponent from './Chatcomponent';\nimport socket from './socket';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Hometalk() {\n  _s();\n  const [username, setUsername] = useState('');\n  const [channels, setChannels] = useState([]);\n  const [activeChannel, setActiveChannel] = useState(null);\n\n  // Fonction pour rafraîchir la liste des channels\n  const fetchChannels = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch('http://localhost:5000/api/channels', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      const data = await response.json();\n      if (response.ok) {\n        setChannels(data);\n        if (!activeChannel && data.length > 0) setActiveChannel(data[0]);\n        if (activeChannel && !data.find(c => c._id === activeChannel._id)) setActiveChannel(data[0] || null);\n      }\n    } catch (err) {\n      console.error('Erreur lors du chargement des channels:', err);\n    }\n  };\n  useEffect(() => {\n    const fetchUserInfo = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const response = await fetch('http://localhost:5000/api/auth/userinfo', {\n          method: 'GET',\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        const data = await response.json();\n        if (response.status === 200) {\n          setUsername(data.username);\n        }\n      } catch (error) {\n        console.error('Erreur lors de la récupération des informations utilisateur:', error);\n      }\n    };\n    fetchUserInfo();\n    fetchChannels();\n    // eslint-disable-next-line\n  }, []);\n\n  // Join le channel actif côté socket\n  useEffect(() => {\n    const userId = localStorage.getItem('userId');\n    if (activeChannel && userId) {\n      var _window$socket;\n      (_window$socket = window.socket) === null || _window$socket === void 0 ? void 0 : _window$socket.emit('joinChannel', {\n        userId,\n        channelId: activeChannel._id\n      });\n      return () => {\n        var _window$socket2;\n        (_window$socket2 = window.socket) === null || _window$socket2 === void 0 ? void 0 : _window$socket2.emit('quitChannel', {\n          userId,\n          channelId: activeChannel._id\n        });\n      };\n    }\n  }, [activeChannel]);\n  const handleChannelClick = channel => {\n    setActiveChannel(channel);\n  };\n  const handleLogout = () => {\n    localStorage.removeItem('token');\n    window.location.href = '/log';\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"hometalk-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"channel-box\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Canaux\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: [channels.length === 0 && /*#__PURE__*/_jsxDEV(\"li\", {\n          className: \"channel-item\",\n          children: \"Aucun channel disponible. Utilisez /create pour en cr\\xE9er un.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 37\n        }, this), channels.map(channel => /*#__PURE__*/_jsxDEV(\"li\", {\n          className: `channel-item${activeChannel && activeChannel._id === channel._id ? ' active' : ''}`,\n          onClick: () => handleChannelClick(channel),\n          children: channel.name\n        }, channel._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"profile-card\",\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"username\",\n        children: username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"logout-button\",\n      onClick: handleLogout,\n      children: \"Se d\\xE9connecter\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content\",\n      children: /*#__PURE__*/_jsxDEV(ChatComponent, {\n        username: username,\n        channel: activeChannel,\n        channels: channels,\n        setChannels: setChannels,\n        fetchChannels: fetchChannels\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 5\n  }, this);\n}\n_s(Hometalk, \"abJsxFKdVxmhVuLubxfIxSBpy8w=\");\n_c = Hometalk;\nexport default Hometalk;\nvar _c;\n$RefreshReg$(_c, \"Hometalk\");","map":{"version":3,"names":["React","useState","useEffect","ChatComponent","socket","jsxDEV","_jsxDEV","Hometalk","_s","username","setUsername","channels","setChannels","activeChannel","setActiveChannel","fetchChannels","token","localStorage","getItem","response","fetch","headers","data","json","ok","length","find","c","_id","err","console","error","fetchUserInfo","method","status","userId","_window$socket","window","emit","channelId","_window$socket2","handleChannelClick","channel","handleLogout","removeItem","location","href","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","onClick","name","_c","$RefreshReg$"],"sources":["C:/Users/momod/T-JSF-600-PAR_2/irc-client/src/Hometalk.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './Hometalk.css';\r\nimport ChatComponent from './Chatcomponent';\r\nimport socket from './socket';\r\n\r\nfunction Hometalk() {\r\n  const [username, setUsername] = useState('');\r\n  const [channels, setChannels] = useState([]);\r\n  const [activeChannel, setActiveChannel] = useState(null);\r\n\r\n  // Fonction pour rafraîchir la liste des channels\r\n  const fetchChannels = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const response = await fetch('http://localhost:5000/api/channels', {\r\n        headers: { 'Authorization': `Bearer ${token}` },\r\n      });\r\n      const data = await response.json();\r\n      if (response.ok) {\r\n        setChannels(data);\r\n        if (!activeChannel && data.length > 0) setActiveChannel(data[0]);\r\n        if (activeChannel && !data.find(c => c._id === activeChannel._id)) setActiveChannel(data[0] || null);\r\n      }\r\n    } catch (err) {\r\n      console.error('Erreur lors du chargement des channels:', err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchUserInfo = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        const response = await fetch('http://localhost:5000/api/auth/userinfo', {\r\n          method: 'GET',\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n          },\r\n        });\r\n        const data = await response.json();\r\n        if (response.status === 200) {\r\n          setUsername(data.username);\r\n        }\r\n      } catch (error) {\r\n        console.error('Erreur lors de la récupération des informations utilisateur:', error);\r\n      }\r\n    };\r\n    fetchUserInfo();\r\n    fetchChannels();\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  // Join le channel actif côté socket\r\n  useEffect(() => {\r\n    const userId = localStorage.getItem('userId');\r\n    if (activeChannel && userId) {\r\n      window.socket?.emit('joinChannel', { userId, channelId: activeChannel._id });\r\n      return () => {\r\n        window.socket?.emit('quitChannel', { userId, channelId: activeChannel._id });\r\n      };\r\n    }\r\n  }, [activeChannel]);\r\n\r\n  const handleChannelClick = (channel) => {\r\n    setActiveChannel(channel);\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('token');\r\n    window.location.href = '/log';\r\n  };\r\n\r\n  return (\r\n    <div className=\"hometalk-container\">\r\n      <div className=\"channel-box\">\r\n        <h3>Canaux</h3>\r\n        <ul>\r\n          {channels.length === 0 && <li className=\"channel-item\">Aucun channel disponible. Utilisez /create pour en créer un.</li>}\r\n          {channels.map(channel => (\r\n            <li key={channel._id} className={`channel-item${activeChannel && activeChannel._id === channel._id ? ' active' : ''}`} onClick={() => handleChannelClick(channel)}>\r\n              {channel.name}\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n      <div className=\"profile-card\">\r\n        <h2 className=\"username\">{username}</h2>\r\n      </div>\r\n      <button className=\"logout-button\" onClick={handleLogout}>\r\n        Se déconnecter\r\n      </button>\r\n      <div className=\"content\">\r\n        <ChatComponent username={username} channel={activeChannel} channels={channels} setChannels={setChannels} fetchChannels={fetchChannels} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Hometalk;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}